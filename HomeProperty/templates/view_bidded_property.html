<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>View Bidded Properties</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/font-awesome.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/slick.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/nouislider.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/jquery.fancybox.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/theme-color/default-theme.css') }}"> 

  <style>
    .property-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    .property-card {
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 8px;
      background: #fff;
      text-align: center;
    }
    .property-card img {
      max-width: 100%;
      border-radius: 8px;
    }
    .property-card h4, .property-card p {
    color: black;
    }
    .bid-button {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      background-color: #4caf50;
      color: white;
      border: none;
      cursor: pointer;
    }
    .bid-button:hover {
      background-color: #45a049;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.4);
    }
    .modal-content {
      background-color: #fff;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 50%;
      border-radius: 8px;
      text-align: center;
    }
    .modal-content label, .modal-content input {
      display: block;
      margin: 10px auto;
    }
    .modal-content input {
      padding: 10px;
      width: 80%;
      text-align: center;
    }
    .modal-content .bid-button {
      margin-top: 15px;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover {
      color: black;
    }
  </style>
  <!-- Google Font -->
  <link href='https://fonts.googleapis.com/css?family=Vollkorn' rel='stylesheet' type='text/css'>    
  <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
</head>
<body class="aa-price-range">

<header id="aa-header">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="aa-header-area">
          <div class="row">
            <div class="col-md-6">
              <div class="aa-header-left">
                <div class="aa-telephone-no">
                  <span class="fa fa-phone"></span> 1-900-523-3564
                </div>
                <div class="aa-email hidden-xs">
                  <span class="fa fa-envelope-o"></span> info@markups.com
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="aa-header-right">
                {% if 'username' in session %}
                  <a href="{{ url_for('auth.logout') }}" class="aa-logout">Logout</a>
                {% else %}
                  <a href="{{ url_for('auth.create_account') }}" class="aa-register">Register</a>
                  <a href="{{ url_for('auth.login') }}" class="aa-login">Login</a>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<section id="aa-menu-area">
  <nav class="navbar navbar-default main-navbar" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <a class="navbar-brand aa-logo" href="/"> Home <span>Property</span></a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right aa-main-nav">
          <li><a href="/">HOME</a></li>
          {% if 'username' in session %}
            {% if session['user_type'] == 'seller' %}
              <li><a href="/list-property">List Property</a></li>
              <li><a href="/view_your_property">Your Property</a></li>
            {% elif session['user_type'] == 'agent' %}
              <li><a href="/view_listed_property">View Listed Property</a></li>
              <li class="active"><a href="/view_bidded_property">View Bidded Property</a></li>
            {% endif %}
            <li><a href="/logout" class="aa-logout">Logout</a></li>
          {% else %}
            <li><a href="/create_account">Register</a></li>
            <li><a href="/login">Login</a></li>
          {% endif %}
        </ul>
      </div>
    </div>
  </nav>
</section>

<div class="bidded-properties-container">

    <h2>Your Bidded Properties</h2>
    <div class="container" style="margin-top: 30px";>
      <div class="form-group mb-4">
        <label for="statusFilter"><strong>Filter by Status:</strong></label>
        <select id="statusFilter" class="form-control" onchange="filterProperties()">
          <option value="all">All</option>
          <option value="A">Active</option>
          <option value="C">Sold</option>
          <option value="X">Closed</option>
        </select>
      </div>
    {% if listings %}
      <div class="row">
        {% for listing in listings %}
        <div class="col-md-4 mb-4 property-card status-{{ listing['status'] }}">

            <div class="card">
              <img src="{{ url_for('static', filename='img/item/1.jpg') }}" class="card-img-top" alt="Property Image">
              <div class="card-body">
                <h5 class="card-title">{{ listing['flat_type'] }} in {{ listing['town'] }}</h5>
                <p class="card-text">
                  <strong>Size:</strong> {{ listing['floor_area'] }} SQ FT<br>
                  <strong>Price:</strong> ${{ listing['listing_price'] }}<br>
                  <strong>Status:</strong>
                  {% if listing['status'] == 'A' %}
                    <span class="badge bg-success">Active</span>
                  {% elif listing['status'] == 'C' %}
                    <span class="badge bg-danger">Sold</span>
                  {% else %}
                    <span class="badge bg-secondary">Closed</span>
                  {% endif %}<br>
                  <strong>Your Bid:</strong> {{ listing['your_bid'] }}%
                  <p><strong>Lowest Bid:</strong> {{ listing['lowest_bid'] }}%</p>
                  {% if listing['your_bid'] > listing['lowest_bid'] %}
                  <p style="color:red;"><strong>You’ve been outbid.</strong></p>
                  <button class="bid-button"
                          data-property-id="{{ listing['id'] }}"
                          data-title="{{ listing['flat_type'] }} in {{ listing['town'] }}"
                          data-max="{{ listing['max_com_bid'] }}"
                          data-status="{{ listing['status'] }}"
                          onclick="handleBidClick(this)">Rebid</button>
                {% else %}
                  <p style="color:green;"><strong>You are currently leading!</strong></p>
                {% endif %}
                </p>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-center text-muted">You haven’t placed any bids yet.</p>
    {% endif %}
  </div>
  <!-- Modal for Bidding -->
  <div id="bidModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeBidModal()">&times;</span>
      <h2 id="property-name"></h2>
      <label for="final-commission">Enter Commission (%)</label>
      <input type="number" id="final-commission" class="form-control" placeholder="Enter commission percentage">
      <button class="bid-button" onclick="placeBid()">Submit Bid</button>
    </div>
  </div>
</div>





<footer id="aa-footer" style="margin-top: 50px;">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="aa-footer-area text-center">
          <p>Designed by <a rel="nofollow" href="http://www.markups.io/">MarkUps.io</a></p>
        </div>
      </div>
    </div>
  </div>
</footer>
<script>
  function filterProperties() {
    const selectedStatus = document.getElementById('statusFilter').value;
    const cards = document.querySelectorAll('.property-card');
  
    cards.forEach(card => {
      if (selectedStatus === 'all') {
        card.style.display = 'block';
      } else {
        card.style.display = card.classList.contains(`status-${selectedStatus}`) ? 'block' : 'none';
      }
    });
  }
  </script>
<script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/bootstrap.js') }}"></script>
<script src="{{ url_for('static', filename='js/slick.js') }}"></script>
<script src="{{ url_for('static', filename='js/nouislider.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.mixitup.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.fancybox.pack.js') }}"></script>
<script src="{{ url_for('static', filename='js/custom.js') }}"></script>
<script src="{{ url_for('static', filename='js/bidding.js') }}"></script>
<script src="{{ url_for('static', filename='js/login.js') }}"></script>
<script src="{{ url_for('static', filename='js/logout.js') }}"></script>


</body>
</html>
